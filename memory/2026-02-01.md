# 2026-02-01

## Webchat Payload Size Issue
- User reported "event gap messages" when trying to send an image via webchat
- Actually a websocket payload size limit error (`Max payload size exceeded`)
- Gateway logs showed: `[ws] error conn=... Max payload size exceeded` followed by disconnect
- User had sent images successfully before, so this is either:
  - A recent gateway update that tightened limits
  - Or a larger image than usual
- **Resolution:** User successfully sent the image on retry (smaller/compressed)
- **Note:** The gateway config schema doesn't expose `gateway.webchat.maxPayloadBytes` — payload limit is currently hardcoded

## Camera System - Dual View Setup
- **Purpose:** User set up dual camera system for rover navigation calibration
  - External camera (Foscam) shows third-person view of rover position
  - Rover's onboard camera (ESP32-CAM) shows first-person view
  - Allows correlating "where rover is" with "what rover sees"
  
- **Foscam (External Reference Camera):**
  - RTSP URL: `rtsp://zcamz:merfda13@192.168.2.208:88/videoMain`
  - Credentials stored in `~/.openclaw/.env` as FOSCAM_USER/FOSCAM_PASS
  - Shows rover position in hallway/doorway area
  - Snapshot command: `ffmpeg -rtsp_transport tcp -i "rtsp://$FOSCAM_USER:$FOSCAM_PASS@192.168.2.208:88/videoMain" -frames:v 1 -q:v 2 -update 1 /tmp/foscam_snapshot.jpg -y`
  
- **GalaxyRVR Onboard Camera:**
  - URL: `http://192.168.10.118:9000/mjpg`
  - Tilt servo control: `/servo?angle=X` (0-140°)
  
- **Current rover position:** Just outside doorway threshold, facing into interior hallway
- User moved gate to left side to improve visibility
- Both camera URLs now documented in TOOLS.md

## GalaxyRVR Power & Upgrade Planning

### Battery Discussion - LiFePO4 for Rover
- User has ExpertPower LiFePO4 batteries from ham radio setup:
  - **4S 12.8V 20Ah** (ExpertPower EP1220) - 5 lbs, 7.1×3×6.6"
  - **12V 10Ah** (ExpertPower EP1210) - 2.7 lbs, 6×2.6×3.7"
  - Both have built-in BMS, 2500-7000 cycle lifespan
  - Originally purchased for ham radio, but perfect for rover use
  
- **Reality check:** Small tracked chassis (XiaoR ~300mm) won't fit these batteries internally
  - 20Ah battery is 6.6" tall but chassis is only 4.9" total height
  - Would need external top-mount OR larger chassis
  
- **User clarified mission:** Build outdoor patrol rover that can "drive around property on a whim" and auto-return to charging dock
  - This changes scale from "indoor toy" to "outdoor endurance platform"
  - Multi-hour runtime requirement
  - Weather-resistant + dog-proof
  - Auto-charging capability

- **Development approach:** User wants to start small for testing
  - Phase 1: GalaxyRVR (current) - learning platform
  - Phase 2: Small tracked chassis (~$60) - prove concepts
  - Phase 3: Large outdoor rover - final platform
  - Smart iterative development to avoid big $ on unproven design

### GalaxyRVR Pi Zero 2W Power Solution
- Current: Pi Zero 2W (NOT Pi 4/5 - much lower power!)
  - Only needs ~0.8A typical, 1.2A peak
  - VS Pi 4/5 which need 2-4A
  
- **Chosen solution:** Small USB power bank
  - 5000mAh bank powers Pi independently (~6+ hours)
  - GalaxyRVR battery powers motors/Arduino/ESP32-CAM
  - **Key benefit:** USB cable from Pi → Arduino enables OTA firmware updates
  - Can SSH to rover and flash Arduino remotely via `arduino-cli`
  
- Total power budget with Pi Zero 2W: ~3.3-4.3A (reasonable)

### Flight Controller Replacement Plan
- **Key insight:** User has 30+ FPV flight controllers (F4/F7/H7) from drone hobby
- Replace Arduino + shield with flight controller for GalaxyRVR
  
**Why flight controller is better:**
- ✅ Built-in IMU (gyro + accel for tilt detection)
- ✅ 5V BEC powers everything (Pi + sensors + camera)
- ✅ Current sensor for battery monitoring
- ✅ Multiple UARTs (GPS, Pi MAVLink, ELRS receiver)
- ✅ Native encoder support on input pins
- ✅ ArduRover firmware = ground vehicle optimized
- ✅ Full RC integration with TX16 + telemetry
- ✅ Already owns them - $0 cost!

**GalaxyRVR motor layout clarified:**
- **6 wheels** but only **2 drive motors** (left + right side)
- Rocker-bogie suspension = wheels mechanically linked per side
- Front/middle/rear wheels on each side rotate together
- 4 control pins: in1/in2 (left), in3/in4 (right) - standard H-bridge
- Camera tilt servo = 1 servo output
- Optional RGB LED strip

**GalaxyRVR motor layout clarified:**
- **6 motors** (one per wheel) wired in 2 parallel groups
- Right side: 3 motors share pins 2 & 3 via shield's H-bridge
- Left side: 3 motors share pins 4 & 5 via shield's H-bridge
- Total draw: 3-6A under load
- Rocker-bogie suspension (NASA Mars rover style)
- Camera servo on pin 6, RGB strips on 11/12/13
- **User decision: Keep GalaxyRVR hardware as-is for now** (Arduino + Shield)
- Focus on adding encoders and mastering software first
- FC upgrade deferred until basics proven

**FC requirements:**
- 2 motor outputs (left/right) ✅
- 1 servo output (camera) ✅
- 2+ UARTs (Pi + ELRS) ✅
- 5V BEC ≥1A ✅
- Any F4 or better easily handles this

**Current plan - SIMPLIFIED:**
1. ✅ Keep Arduino + GalaxyRVR Shield (works, don't over-complicate)
2. Order wheel encoders (~$8) - LM393 speed sensors with 20-slot discs
3. Find USB power bank for Pi Zero 2W (check existing inventory)
4. Add encoder integration code
5. Master navigation/odometry on current platform
6. Upgrade hardware later once software proven

### Wheel Encoder Addition
- LM393 optical speed sensors with 20-slot encoder discs
- Mount on rear wheels for odometry feedback
- Wire directly to Pi GPIO or FC input pins
- Enables real distance measurement vs time-based guessing
- Detect wheel slip/drift on carpet
- Cost: ~$8-10 for pair with discs

## Context
- Gateway running on `zaipc` (Linux 6.8.0-94-generic)
- Only Telegram channel configured (no Discord)
- Workspace: `/home/zolon/.openclaw/workspace`
